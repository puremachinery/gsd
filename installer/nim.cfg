# nim.cfg — compiler hardening for GSD installer
# Applied automatically when compiling from the installer/ directory.

# ── Style & lint ──────────────────────────────────────────────
--styleCheck:hint                       # observe first; promote to :error later
--warning[UnusedImport]:on
--warning[ProveInit]:on

# ── Runtime safety ────────────────────────────────────────────
--checks:on
--overflowChecks:on

# ── Release hardening (C compiler flags) ─────────────────────
# PIE, stack-protector, FORTIFY_SOURCE, format-string checks
@if release and not windows:
  --passC:"-fPIE"
  --passC:"-fstack-protector-all"
  --passC:"-D_FORTIFY_SOURCE=2"
  --passC:"-Wformat"
  --passC:"-Wformat-security"
@end

# ── Release hardening (linker flags) ─────────────────────────
@if release and linux:
  --passL:"-pie"
  --passL:"-Wl,-z,relro,-z,now"
@end

@if release and macosx:
  # macOS defaults to PIE; no extra linker flag needed.
@end
